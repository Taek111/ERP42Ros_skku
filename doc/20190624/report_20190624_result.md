# Report 20190624 result

- 작성자 : 가태권
- 작성일시 : 2019-06-24

- 실험일시 : 2019-06-24 23:00 - 24:00
- 날씨 : 맑음
- 참여인원 : 2명
  - 조장 : 오일호
  - 조원 : 가태권 

## 실험 목표
- ERP42위에 UPPER 컨트롤러로 쓰일  Jetson TX2를 부착하고 전원과 변압기를 통해 전원을 연결하여  제대로 작동하는지 확인한다. 
- Jetson TX2와 PCU를 연결하고 ERP42Ros 노드를 실행하여 UPPER와 PCU간 RS232통신을 확인한다. 
- Auto mode를 구동함에 있어서 의도치 않은 에러가 있는지 확인한다. 

## 실험 과정
1. 사전보고서의 내용대로 로봇을 리프트업 함  
1. ERP42에 Jetson TX2과 거치대를 부착하고 체크리스트의 순서에 따라 로봇과 Jetson의 전원을 켬. 
1. Manual mode에서 전진, 후진, 조향, 브레이크 등의 기능이 동작하는 것을 확인한 후 Auto mode로 바꿈.
1. Jetson에서 ERP42Ros 노드 실행 후 결과 확인 
1. 리프트 다운 및 정리 

## 실험 결과 
1. Auto mode에서 ERP42Ros 노드를 실행할 때 프로그래밍 된 대로, UPPER 컨트롤러에서 13바이트 패킷읽기, 14바이트 패킷 쓰기 동작이 제대로 수행되었다. 그러나 ALIVE 바이트가 증가하긴 하였으나 1씩 올라가지 않고, 실험이 끝난 뒤 log 파일이 정상적으로 저장되지 않았다. 

## 새로 알게된 사실
1. Upper-to-PCU 패킷과 PCU-to-UPPER 패킷의 마지막 2 바이트는 Carriage Return (CR,0x0d)과 Line Feed (LF, 0x0a)이다. 
1. log파일 쓰기의 실패로 실험 후 코드를 분석한 결과, log 파일을 저장할 때에 fstream을 사용했는데 ROS에서 fstream을 할 경우에 rosrun 커맨드를 실행한 위치로부터의 상대위치에 log파일이 저장되게 된다. 따라서 ERP42Ros.cpp에서 설정한 상대경로가 올바르도록 rosrun을 적절한 위치에서 실행해야 한다.  

## 고찰
1. 현재 패킷읽기를 시작문자의 X를 읽고난 후 13바이트를 읽는 방식으로 구현했는데, 만약 UPPER 컨트롤러가  시작 문자를 놓치고 혹시나 13바이트의 패킷 중 ASCII 코드 X(0X58)에 해당하는 값이 들어오면 패킷 통신의 동기화가 꼬일 수 있다. 따라서 이와 같은 에러를 최대한 줄이기 위해 큐를 이용해 시작 문자 S, T, X를 모두 체크할 필요가 있고, 또한  ETX0, ETX1을  활용할 수 있는 방안도 생각해 봐야 한다.

1.  실험 결과 패킷의 ALIVE값이 1씩 일정하게 오르지 않고 불연속적으로 증가했는데, 다음 실험 때 log값을 분석해 정확한 ALIVE 값의 변화를 파악하고 문제점을 찾아야 한다. 특히 UPPER-to-PUC 패킷은 Big Endian이고 PCU-to-UPPER 패킷은 Little Endian인데 패킷의 바이트 순서가 올바른지 다시한번 확인할 필요가 있다. 
